# 关于播放器的说明

**由于`APlayer`本身的限制，因此实现某些功能通过其他途径来实现：**

## 关于参数

- `playList`：总列表，直接用于APlayer中（默认为`[]`）
- `playIndex`：播放索引位置（从0开始），用于锁定到当前播放的位置（默认为`0`）
- `playMode`：播放模式，有`list`和`random`两种（默认为`list`）
- `nextFlag`：临时变量，下面有说明（默认为`false`）
- `isPlay`：是否在播放（默认为`false`）

## 播放

### 播放下一首歌

#### 通过按钮/Control Panel点击的

1. 执行函数`nextSongHandler`
2. 如果是列表顺序播放的
   1. 执行`APlayer`的`skipForward`方法跳转到下一首歌
   2. 执行函数`nextSong`
      1. 确保当前是列表播放的
      2. 将索引+1（循环）
3. 如果是随机播放的
   1. 随机生成一个数（在列表范围内）
   2. 索引值为这个数
   3. 执行`APlayer`的`switch`方法跳转到这个索引值

#### 自动下一首

1. 监听是否播放结束（`ended`监听），如果结束了
   1. 将`nextFlag`这个临时变量赋值为`true`
   2. 执行函数`nextSong`
      1. 如果当前是列表播放的
         1. 如果不是，直接退出
      2. 将索引+1（循环）
2. 监听是否准备好数据播放了（`loadeddata`监听），如果准备好了
   1. 如果当前是随机播放的，并且`nextFlag`这个临时变量为`true`
      1. 随机生成一个数（在列表范围内）
      2. 索引值为这个数
      3. 执行`APlayer`的`switch`方法跳转到这个索引值
   2. 如果当前不是随机播放的，或者`nextFlag`这个临时变量不是`true`，那么说明不需要执行当前函数
   3. 将`nextFlag`这个临时变量恢复为`false`

* **关于为什么监听两个状态**：因为`switch`这个方法和默认的`play()`冲突（因为播放完成就进入下一首了，会自动播放）
* **关于为什么需要变量`nextFlag`**：因为`loadeddata`这个监听事件并不是只有在切换歌曲时候发生，可能导致在播放的时候发生